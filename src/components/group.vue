<template>
  <ButtonGroup size="small">
    <!--组合按钮 多选时可用 选中元素组成一个组-->
    <Button :disabled="!isMultiple" @click="group">
      <svg class="icon" height="14" p-id="17131" t="1650848913991" version="1.1"
           viewBox="0 0 1024 1024" width="14" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M341.333333 341.333333 341.333333 512 554.666667 512 554.666667 341.333333 341.333333 341.333333M42.666667 42.666667 213.333333 42.666667 213.333333 85.333333 810.666667 85.333333 810.666667 42.666667 981.333333 42.666667 981.333333 213.333333 938.666667 213.333333 938.666667 810.666667 981.333333 810.666667 981.333333 981.333333 810.666667 981.333333 810.666667 938.666667 213.333333 938.666667 213.333333 981.333333 42.666667 981.333333 42.666667 810.666667 85.333333 810.666667 85.333333 213.333333 42.666667 213.333333 42.666667 42.666667M213.333333 810.666667 213.333333 853.333333 810.666667 853.333333 810.666667 810.666667 853.333333 810.666667 853.333333 213.333333 810.666667 213.333333 810.666667 170.666667 213.333333 170.666667 213.333333 213.333333 170.666667 213.333333 170.666667 810.666667 213.333333 810.666667M256 256 640 256 640 426.666667 768 426.666667 768 768 341.333333 768 341.333333 597.333333 256 597.333333 256 256M640 597.333333 426.666667 597.333333 426.666667 682.666667 682.666667 682.666667 682.666667 512 640 512 640 597.333333Z"
          p-id="17132"></path>
      </svg>
    </Button>
    <!--拆分组合按钮，为单选且是组元素时可用-->
    <Button :disabled="!isGroup" @click="unGroup">
      <svg class="icon" height="14" p-id="17281" t="1650848938557" version="1.1"
           viewBox="0 0 1024 1024" width="14" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M85.333333 85.333333 256 85.333333 256 128 554.666667 128 554.666667 85.333333 725.333333 85.333333 725.333333 256 682.666667 256 682.666667 384 768 384 768 341.333333 938.666667 341.333333 938.666667 512 896 512 896 768 938.666667 768 938.666667 938.666667 768 938.666667 768 896 512 896 512 938.666667 341.333333 938.666667 341.333333 768 384 768 384 682.666667 256 682.666667 256 725.333333 85.333333 725.333333 85.333333 554.666667 128 554.666667 128 256 85.333333 256 85.333333 85.333333M768 512 768 469.333333 682.666667 469.333333 682.666667 554.666667 725.333333 554.666667 725.333333 725.333333 554.666667 725.333333 554.666667 682.666667 469.333333 682.666667 469.333333 768 512 768 512 810.666667 768 810.666667 768 768 810.666667 768 810.666667 512 768 512M554.666667 256 554.666667 213.333333 256 213.333333 256 256 213.333333 256 213.333333 554.666667 256 554.666667 256 597.333333 384 597.333333 384 512 341.333333 512 341.333333 341.333333 512 341.333333 512 384 597.333333 384 597.333333 256 554.666667 256M512 512 469.333333 512 469.333333 597.333333 554.666667 597.333333 554.666667 554.666667 597.333333 554.666667 597.333333 469.333333 512 469.333333 512 512Z"
          p-id="17282"></path>
      </svg>
    </Button>
  </ButtonGroup>
</template>

<script>
import select from '@/mixins/select'

export default {
  name: 'group',
  mixins: [select],
  data () {
    return {}
  },
  computed: {
    // 单选且是组元素
    isGroup () {
      return this.mSelectMode === 'one' && this.mSelectOneType === 'group'
    },
    // 是否为多选
    isMultiple () {
      return this.mSelectMode === 'multiple'
    }
  },
  methods: {
    // 拆分组
    unGroup () {
      // 先获取当前选中的对象，然后分散成多个对象
      this.canvas.c.getActiveObject().toActiveSelection()
      this.canvas.c.discardActiveObject().renderAll()
    },
    // 合并为一组对象
    group () {
      // 组合元素
      let activeObj = this.canvas.c.getActiveObject()
      let activeGroup = activeObj.toGroup()
      let objectsInGroup = activeGroup.getObjects()
      activeGroup.clone((newgroup) => {
        this.canvas.c.remote(activeGroup)
        objectsInGroup.forEach((obj) => {
          this.canvas.c.remove(obj)
        })
        this.canvas.c.add(newgroup)
        this.canvas.c.setActiveObject(newgroup)
      })
    }
  }
}
</script>

<style lang="less" scoped>
/deep/ .ivu-btn[disabled] {
  svg {
    opacity: 0.2;
  }
}
</style>
